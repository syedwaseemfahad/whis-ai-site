<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Whis – The Unfair Advantage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
            colors: { 
              void: '#000000', 
              iris: '#6366f1', 
              cyan: '#06b6d4',
              surface: '#050505'
            },
            backgroundImage: {
              'glass': 'linear-gradient(180deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.0) 100%)',
              'hero-glow': 'radial-gradient(circle at 50% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 60%)'
            }
          }
        }
      }
    </script>
      
    <style>
      /* --- CORE PHYSICS --- */
      html.lenis { height: auto; } 
      .lenis.lenis-smooth { scroll-behavior: auto; } 
      body { 
          background-color: #000; 
          color: white; 
          overflow-x: hidden; 
          -webkit-font-smoothing: antialiased;
      }

      /* --- NAV BAR FIX (Sticky & Visible) --- */
      #navbar {
          transition: background 0.3s ease, border 0.3s ease, transform 0.3s ease;
          will-change: transform, background;
          /* Force GPU layer to prevent disappearing */
          transform: translateZ(0); 
      }
      #navbar.scrolled {
          background: rgba(5, 5, 5, 0.9); 
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border-bottom: 1px solid rgba(255,255,255,0.08);
      }

      /* --- GPU ACCELERATED DECKS --- */
      .deck-stage {
          perspective: 2000px; height: 550px; display: flex; align-items: center; justify-content: center;
      }
      .deck-item {
          position: absolute; width: 80%; max-width: 1000px; aspect-ratio: 16/9;
          border-radius: 20px; background: #000; overflow: hidden;
          /* Critical for smoothness: transition transform only */
          transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s ease;
          box-shadow: 0 40px 80px -20px rgba(0,0,0,0.9);
          will-change: transform, opacity;
      }
      
      .deck-center { 
          transform: translate3d(0, 0, 0); 
          z-index: 20; opacity: 1;
          border: 1px solid rgba(99, 102, 241, 0.5);
      }
      .deck-left { 
          transform: translate3d(-55%, 0, -300px) rotateY(15deg); 
          z-index: 10; opacity: 0.3; pointer-events: none;
      }
      .deck-right { 
          transform: translate3d(55%, 0, -300px) rotateY(-15deg); 
          z-index: 10; opacity: 0.3; pointer-events: none;
      }

      /* --- BUTTONS --- */
      .btn-iris {
          background: #6366f1; color: white; font-weight: 700;
          box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
          transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1);
      }
      .btn-iris:hover { transform: scale(1.05); box-shadow: 0 0 50px rgba(99, 102, 241, 0.6); }

      /* --- SCROLL REVEAL --- */
      .reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease, transform 0.8s ease; will-change: opacity, transform; }
      .reveal.active { opacity: 1; transform: translateY(0); }

      /* Hide scrollbar */
      ::-webkit-scrollbar { width: 0; }
    </style>
</head>
<body id="top">

    <div class="fixed inset-0 z-[-1] pointer-events-none bg-hero-glow opacity-40"></div>
    <div class="fixed inset-0 z-[-1] pointer-events-none bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03]"></div>

    <nav id="navbar" class="fixed top-0 w-full z-[100] h-[80px] flex items-center">
        <div class="w-full max-w-7xl mx-auto px-6 flex items-center justify-between">
            <a href="#top" class="flex items-center gap-3 group cursor-pointer">
                <div class="w-9 h-9 rounded-xl bg-indigo-500/10 flex items-center justify-center border border-indigo-500/30 group-hover:bg-indigo-500/20 transition">
                    <i class="fa-solid fa-bolt text-indigo-400 text-sm"></i>
                </div>
                <span class="font-bold text-white tracking-tight">WHIS.AI</span>
            </a>

            <div class="hidden md:flex items-center gap-1">
                <a href="#logic" class="px-5 py-2 text-xs font-medium text-slate-400 hover:text-white transition">Logic</a>
                <a href="#demo" class="px-5 py-2 text-xs font-medium text-slate-400 hover:text-white transition">Demo</a>
                <a href="#pricing" class="px-5 py-2 text-xs font-medium text-slate-400 hover:text-white transition">Pricing</a>
            </div>

            <div class="flex items-center gap-4">
                <button id="navSignIn" onclick="openLoginModal()" class="text-xs font-bold text-slate-400 hover:text-white uppercase tracking-wider transition">Log In</button>
                
                <div id="navProfile" class="hidden items-center gap-2 bg-white/5 pr-3 pl-1 py-1 rounded-full border border-white/10 hover:border-indigo-500 transition cursor-pointer" onclick="openProfileModal()">
                    <img id="navAvatar" src="" class="w-7 h-7 rounded-full bg-slate-800 object-cover" />
                    <span class="text-[9px] font-bold text-indigo-400 uppercase tracking-wide">PRO</span>
                </div>

                <button id="navDownload" onclick="handleDownload()" class="bg-white text-black px-6 py-2.5 rounded-full text-xs font-bold uppercase hover:bg-slate-200 transition shadow-lg">
                    Get Whis
                </button>
            </div>
        </div>
    </nav>

    <section class="relative pt-44 pb-20 flex flex-col items-center text-center px-4 min-h-screen">
        <div class="reveal active inline-flex items-center gap-2 px-3 py-1 rounded-full border border-indigo-500/30 bg-indigo-500/10 mb-8 backdrop-blur-md">
            <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse"></span>
            <span class="text-[10px] font-bold text-indigo-300 tracking-widest uppercase">System Operational</span>
        </div>

        <h1 class="reveal active text-6xl md:text-9xl font-black tracking-tighter mb-8 leading-[0.95] drop-shadow-2xl">
            <span class="text-white">UNFAIR</span><br>
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">ADVANTAGE</span>
        </h1>

        <p class="reveal active text-slate-400 text-lg mb-12 max-w-xl font-light">
            The invisible AI copilot. <span class="text-white font-medium">Zero lag. Zero detection.</span>
        </p>

        <div class="reveal active flex gap-4 mb-24">
            <button id="heroDownload" onclick="handleDownload()" class="btn-iris rounded-full px-12 py-4 text-sm flex items-center gap-3 font-bold">
                <i class="fa-brands fa-apple text-xl"></i> <span>Download</span>
            </button>
        </div>

        <div class="reveal active w-full max-w-6xl relative z-10">
            <div class="deck-stage" id="deckStage"></div>
            
            <div class="flex justify-center gap-3 mt-12">
                <button onclick="setDeck(0)" id="pip-0" class="w-10 h-1.5 bg-indigo-500 rounded-full transition-all"></button>
                <button onclick="setDeck(1)" id="pip-1" class="w-2 h-1.5 bg-white/20 hover:bg-white rounded-full transition-all"></button>
                <button onclick="setDeck(2)" id="pip-2" class="w-2 h-1.5 bg-white/20 hover:bg-white rounded-full transition-all"></button>
            </div>
        </div>
    </section>

    <section id="demo" class="py-32 bg-surface border-t border-white/5">
        <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
            <div class="reveal">
                <h2 class="text-4xl md:text-5xl font-black text-white mb-6 tracking-tight">Watch it think.</h2>
                <p class="text-slate-400 text-lg">The code generates instantly. No typing required. The interface is optimized for speed.</p>
            </div>
            <div class="reveal bg-[#0A0A0A] rounded-xl border border-white/10 p-6 h-[350px] font-mono text-xs text-emerald-400 overflow-hidden relative shadow-2xl">
                <div id="typewriter"></div>
                <span class="absolute bottom-4 right-4 text-[10px] text-slate-600 tracking-widest uppercase">LIVE OUTPUT STREAM</span>
            </div>
        </div>
    </section>

    <footer class="py-20 text-center border-t border-white/5 bg-void">
        <h2 class="reveal text-3xl font-bold text-white mb-8">Secure Your Future.</h2>
        <button onclick="handleDownload()" class="reveal btn-iris rounded-full px-12 py-4 text-sm uppercase tracking-widest font-bold">Get The Advantage</button>
        <p class="mt-8 text-slate-700 text-xs font-mono">© 2025 Whis AI.</p>
    </footer>

    <div id="loginModal" class="fixed inset-0 bg-black/90 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-[#0A0A0A] border border-white/10 rounded-2xl p-8 w-full max-w-sm text-center relative shadow-2xl">
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold mb-6 text-white">Sign In</h3>
            <div id="googleBtnContainer" class="flex justify-center"></div>
        </div>
    </div>

    <div id="profileModal" class="fixed inset-0 bg-black/90 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-[#0A0A0A] border border-white/10 rounded-2xl w-full max-w-md relative shadow-2xl">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <div class="flex items-center gap-3"><img id="modalAvatar" class="w-10 h-10 rounded-full" /><div class="font-bold text-white" id="modalName"></div></div>
                <button onclick="closeProfileModal()" class="text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4 mb-6">
                    <div class="text-[10px] text-indigo-300 uppercase tracking-widest mb-1">CURRENT PLAN</div>
                    <div class="text-xl font-bold text-white" id="modalPlan">Checking...</div>
                </div>
                <button onclick="logout()" class="w-full py-3 rounded-lg border border-white/10 text-slate-400 hover:bg-white hover:text-black transition text-xs font-bold uppercase">Sign Out</button>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL="https://whis-backend.onrender.com";
        const GOOGLE_CLIENT_ID="91011354786-0giqfdd547vj6ojkk26qdj4jucl5v07p.apps.googleusercontent.com";
        
        // --- 1. LOCAL STORAGE MANAGER (PERSISTENCE) ---
        const Storage = {
            saveUser: (user) => localStorage.setItem('whisUser', JSON.stringify(user)),
            getUser: () => {
                const u = localStorage.getItem('whisUser');
                return u ? JSON.parse(u) : null;
            },
            clearUser: () => localStorage.removeItem('whisUser')
        };

        // --- 2. PERFORMANCE SCROLL ---
        const lenis = new Lenis({ duration: 1.2, easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), smooth: true });
        function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
        requestAnimationFrame(raf);

        // --- 3. VIDEO MANAGER (ZERO LAG) ---
        const deckData = [
            { src: 'visual.mp4' },
            { src: 'text.mp4' },
            { src: 'audio.mp4' }
        ];
        let deckIndex = 0;

        function initDeck() {
            const stage = document.getElementById('deckStage');
            stage.innerHTML = '';
            deckData.forEach((item, i) => {
                const el = document.createElement('div');
                el.className = 'deck-item'; el.id = `deck-${i}`;
                const vid = document.createElement('video');
                vid.src = item.src;
                vid.muted = true; vid.loop = true; vid.playsInline = true;
                vid.preload = "none"; // Critical for load speed
                vid.className = "w-full h-full object-cover";
                el.appendChild(vid);
                stage.appendChild(el);
            });
            updateDeck();
        }

        function updateDeck() {
            const items = [document.getElementById('deck-0'), document.getElementById('deck-1'), document.getElementById('deck-2')];
            const pips = [document.getElementById('pip-0'), document.getElementById('pip-1'), document.getElementById('pip-2')];
            const prev = (deckIndex - 1 + 3) % 3; const next = (deckIndex + 1) % 3;

            items[deckIndex].className = 'deck-item deck-center';
            items[prev].className = 'deck-item deck-left';
            items[next].className = 'deck-item deck-right';

            items.forEach((el, idx) => {
                const v = el.querySelector('video');
                if (idx === deckIndex) { v.play().catch(()=>{}); } 
                else { v.pause(); v.currentTime = 0; }
            });

            pips.forEach((p, i) => {
                if(i===deckIndex) p.className="w-8 h-1.5 bg-indigo-500 rounded-full transition-all";
                else p.className="w-2 h-1.5 bg-white/20 hover:bg-white rounded-full transition-all cursor-pointer";
            });
        }
        function setDeck(i) { deckIndex = i; updateDeck(); }

        // --- 4. AUTH LOGIC (PERSISTENT) ---
        let currentUser = null;

        function updateUI(u) {
            const loginBtn = document.getElementById('navSignIn');
            const profileBtn = document.getElementById('navProfile');
            
            if (u) {
                // User logged in
                loginBtn.classList.add('hidden');
                profileBtn.classList.remove('hidden');
                profileBtn.classList.add('flex');
                document.getElementById('navAvatar').src = u.avatarUrl;
                document.getElementById('modalAvatar').src = u.avatarUrl;
                document.getElementById('modalName').innerText = u.name;
            } else {
                // Guest
                loginBtn.classList.remove('hidden');
                profileBtn.classList.add('hidden');
                profileBtn.classList.remove('flex');
            }
        }

        // --- 5. OS DETECTION (CONTEXTUAL) ---
        function detectOS() {
            const isWin = navigator.platform.toLowerCase().includes('win');
            const heroBtn = document.getElementById('heroDownload');
            const navBtn = document.getElementById('navDownload');
            
            if (isWin) {
                heroBtn.innerHTML = '<i class="fa-brands fa-windows text-xl"></i> <span>Download for Windows</span>';
                navBtn.innerText = 'Get Whis (Win)';
            } else {
                heroBtn.innerHTML = '<i class="fa-brands fa-apple text-xl"></i> <span>Download for macOS</span>';
                navBtn.innerText = 'Get Whis (Mac)';
            }
            return isWin ? 'win' : 'mac';
        }

        function handleDownload() {
            const os = detectOS() === 'win';
            if (os) window.location.href="https://github.com/syedwaseemfahad/whis-releases/releases/download/v.1.0.windows/Whis.Setup.1.0.1.exe";
            else window.location.href="https://github.com/syedwaseemfahad/whis-releases/releases/download/v1.0.0/Whis-1.0.0-arm64.dmg";
        }

        // --- 6. MODALS ---
        const loginModal = document.getElementById('loginModal'); 
        const profileModal = document.getElementById('profileModal');

        function openLoginModal(){ loginModal.classList.remove('hidden'); loginModal.classList.add('flex'); if(window.google) google.accounts.id.renderButton(document.getElementById("googleBtnContainer"),{theme:"filled_black",size:"large"}); }
        function closeLoginModal(){ loginModal.classList.add('hidden'); loginModal.classList.remove('flex'); }
        function openProfileModal(){ profileModal.classList.remove('hidden'); profileModal.classList.add('flex'); fetchStatus(); }
        function closeProfileModal(){ profileModal.classList.add('hidden'); profileModal.classList.remove('flex'); }
        
        function logout(){ 
            Storage.clearUser(); 
            location.reload(); 
        }
        
        async function fetchStatus() {
            if(!currentUser) return;
            try {
                const r = await fetch(`${BACKEND_URL}/api/user/status`, {headers:{'x-google-id':currentUser.googleId}});
                const d = await r.json();
                document.getElementById('modalPlan').innerText = d.active ? 'Elite' : 'Free';
                document.getElementById('navBadge').innerText = d.active ? 'PRO' : 'FREE';
            } catch(e) {}
        }

        window.onload = function() {
            // Load Google Auth
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: async (res) => {
                    const r = await fetch(`${BACKEND_URL}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:res.credential})});
                    const d = await r.json();
                    if(d.success) {
                        currentUser = d.user;
                        Storage.saveUser(currentUser); // Persist!
                        updateUI(currentUser);
                        closeLoginModal();
                    }
                }
            });
        }

        // --- 7. TYPEWRITER ---
        const codeText = "def solve(input):\n  # Audio Analysis...\n  return optimal_solution";
        const typeEl = document.getElementById('typewriter');
        let typeI = 0;
        function type() {
            if(typeI < codeText.length) { typeEl.innerHTML += codeText.charAt(typeI); typeI++; setTimeout(type, 50); }
            else { setTimeout(()=>{typeEl.innerHTML=''; typeI=0; type();}, 2000); }
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            initDeck();
            detectOS();
            
            // LOAD USER FROM LOCAL STORAGE
            const storedUser = Storage.getUser();
            if (storedUser) {
                currentUser = storedUser;
                updateUI(currentUser);
                fetchStatus();
            }

            // Scroll Logic
            window.addEventListener('scroll', () => {
                const nav = document.getElementById('navbar');
                if (window.scrollY > 50) nav.classList.add('scrolled');
                else nav.classList.remove('scrolled');
                
                document.querySelectorAll('.reveal').forEach(el => {
                    if (el.getBoundingClientRect().top < window.innerHeight - 100) el.classList.add('active');
                });
            });

            const obs = new IntersectionObserver((e)=>{if(e[0].isIntersecting && typeI===0) type()});
            obs.observe(document.getElementById('demo'));
        });
    </script>
</body>
</html>
