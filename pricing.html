<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pricing – Whis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: { fontFamily: { sans: ['Inter', 'sans-serif'] }, colors: { page: '#050505', card: '#0A0A0A' } }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
  <style>
    body { background-color: #050505; color: white; font-family: 'Inter', sans-serif; }
    .glass-nav { background: rgba(5, 5, 5, 0.7); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .pricing-card { background: #0A0A0A; border: 1px solid rgba(255,255,255,0.08); transition: 0.3s; }
    .pricing-card:hover { border-color: rgba(255,255,255,0.2); }
    .popular-card { background: linear-gradient(180deg, #101010 0%, #0A0A0A 100%); border: 1px solid rgba(59, 130, 246, 0.5); box-shadow: 0 0 40px rgba(59, 130, 246, 0.1); transform: scale(1.02); z-index: 10; }
  </style>
</head>
<body class="antialiased">

  <nav class="fixed top-0 w-full z-50 glass-nav h-[70px] flex items-center justify-center">
    <div class="max-w-7xl w-full px-6 flex justify-between items-center">
      <a href="/" class="flex items-center gap-2"><div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center border border-white/5"><span class="text-xs font-bold">WH</span></div><span class="text-sm font-semibold text-slate-300">whis.ai</span></a>
      <div class="flex items-center gap-6 text-sm font-medium"><a href="support.html" class="text-slate-500 hover:text-white transition">Support</a><button onclick="openLoginModal()" class="text-slate-400 hover:text-white transition">Sign In</button></div>
    </div>
  </nav>

  <section class="pt-40 pb-20 px-6 text-center">
    <h1 class="text-4xl md:text-5xl font-medium mb-6 text-white">Invest in your career.</h1>
    <p class="text-slate-400 text-lg mb-12 font-light">One offer letter pays for a lifetime of Whis.</p>
    
    <div class="inline-flex bg-white/5 p-1 rounded-lg border border-white/10 mb-20">
      <button id="btnMonthly" class="px-8 py-2 rounded-md text-sm font-medium bg-white text-black shadow-lg transition-all" onclick="setCycle('monthly')">Monthly</button>
      <button id="btnAnnual" class="px-8 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-all" onclick="setCycle('annual')">Yearly <span class="text-emerald-400 text-[10px] ml-1 uppercase tracking-wider">Save 50%</span></button>
    </div>

    <div class="max-w-7xl mx-auto grid md:grid-cols-3 gap-6 items-start">
      
      <div class="pricing-card rounded-2xl p-8 text-left flex flex-col h-full">
        <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Starter</h3>
        <div class="mt-4 mb-8"><span class="text-4xl font-medium text-white">Free</span></div>
        <button onclick="window.location.href='/'" class="w-full py-3 rounded-lg border border-white/10 text-slate-300 hover:bg-white/5 text-sm font-medium transition mb-8">Download</button>
        <div class="space-y-4 text-xs text-slate-500">
          <p class="flex gap-3 text-white font-bold"><i class="fa-solid fa-check text-emerald-500"></i> 10 Responses / day</p>
          <p class="flex gap-3"><i class="fa-solid fa-microphone"></i> Basic Audio Analysis</p>
          <p class="flex gap-3"><i class="fa-solid fa-camera"></i> Limited Screenshots</p>
        </div>
      </div>

      <div class="popular-card rounded-2xl p-8 text-left flex flex-col relative">
        <div class="absolute top-0 right-0 bg-blue-600 text-white text-[10px] font-bold px-3 py-1 rounded-bl-xl rounded-tr-xl">POPULAR</div>
        <h3 class="text-sm font-semibold text-blue-400 uppercase tracking-wider">Pro</h3>
        <div class="mt-4 mb-8 flex items-baseline gap-1"><span class="text-5xl font-medium text-white" id="pricePro">₹999</span><span class="text-slate-500">/mo</span></div>
        <button onclick="initiatePayment('pro')" class="w-full py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-500 transition shadow-lg shadow-blue-900/20 mb-8">Upgrade Now</button>
        <div class="space-y-4 text-xs text-slate-300">
          <p class="flex gap-3"><i class="fa-solid fa-infinity text-blue-500"></i> <strong>Unlimited</strong> Audio & Text</p>
          <p class="flex gap-3"><i class="fa-solid fa-desktop text-blue-500"></i> <strong>Screenshare</strong> Analysis</p>
          <p class="flex gap-3"><i class="fa-solid fa-bolt text-blue-500"></i> Turbo Response Time</p>
        </div>
      </div>

      <div class="pricing-card rounded-2xl p-8 text-left flex flex-col h-full relative overflow-hidden group">
        <div class="absolute -top-20 -right-20 w-40 h-40 bg-purple-600/20 blur-[60px] group-hover:bg-purple-600/30 transition duration-700"></div>
        <h3 class="text-sm font-semibold text-purple-400 uppercase tracking-wider flex items-center gap-2">Stealth <i class="fa-solid fa-mask"></i></h3>
        <div class="mt-4 mb-8 flex items-baseline gap-1"><span class="text-4xl font-medium text-white" id="priceStealth">₹1999</span><span class="text-slate-500">/mo</span></div>
        <button onclick="initiatePayment('pro_plus')" class="w-full py-3 rounded-lg bg-white/10 text-white border border-white/10 font-medium hover:bg-white/20 transition mb-8">Get Stealth</button>
        <div class="space-y-4 text-xs text-slate-400 relative z-10">
          <p class="text-[9px] font-bold text-slate-600 uppercase tracking-widest mb-1">Includes Pro, plus:</p>
          <p class="flex gap-3 text-purple-300"><i class="fa-solid fa-eye-slash"></i> 100% Undetectable Process</p>
          <p class="flex gap-3"><i class="fa-solid fa-keyboard"></i> <strong>Stealth Text Input</strong></p>
          <p class="flex gap-3"><i class="fa-solid fa-ghost"></i> Ghost Window Overlay</p>
        </div>
      </div>

    </div>
  </section>

  <div id="loginModal" class="fixed inset-0 bg-black/80 backdrop-blur-xl z-[100] hidden items-center justify-center p-4"><div class="pricing-card rounded-xl p-8 max-w-sm w-full text-center relative shadow-2xl"><button onclick="closeLoginModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button><h3 class="text-lg font-medium text-white mb-6">Sign in to Upgrade</h3><div id="googleBtnContainer" class="flex justify-center"></div></div></div>

  <script>
    const BACKEND_URL="https://whis-backend.onrender.com";const GOOGLE_CLIENT_ID="91011354786-0giqfdd547vj6ojkk26qdj4jucl5v07p.apps.googleusercontent.com";
    let currentCycle='monthly';let currentUser=null; let currentTier = 'free';

    function setCycle(c){
        currentCycle=c;
        const btnM=document.getElementById('btnMonthly');const btnA=document.getElementById('btnAnnual');
        if(c==='monthly'){
            btnM.className="px-8 py-2 rounded-md text-sm font-medium bg-white text-black shadow-lg transition-all";
            btnA.className="px-8 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-all";
            document.getElementById('pricePro').innerText='₹999';document.getElementById('priceStealth').innerText='₹1999';
        }else{
            btnA.className="px-8 py-2 rounded-md text-sm font-medium bg-white text-black shadow-lg transition-all";
            btnM.className="px-8 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-all";
            document.getElementById('pricePro').innerText='₹499';document.getElementById('priceStealth').innerText='₹999';
        }
    }

    async function fetchUserStatus() {
        if(!currentUser) return;
        try {
            const r = await fetch(`${BACKEND_URL}/api/user/status`, {headers:{'x-google-id':currentUser.googleId}});
            const d = await r.json();
            if(d.active) currentTier = d.tier; // 'pro' or 'pro_plus'
            else currentTier = 'free';
        } catch(e) {}
    }

    async function initiatePayment(targetTier){
        if(!currentUser){openLoginModal();return;}
        
        // --- 1. SUBSCRIPTION CHECK LOGIC ---
        if(currentTier === 'pro_plus') {
            alert("You are already on the highest plan (Stealth). No need to upgrade.");
            return;
        }
        if(currentTier === 'pro' && targetTier === 'pro') {
             alert("You already have an active Pro subscription.");
             return;
        }
        // -----------------------------------

        const btn=event.target;const orig=btn.innerText;btn.innerText="Processing...";
        try{
            const res=await fetch(`${BACKEND_URL}/api/payment/create-order`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({googleId:currentUser.googleId,tier:targetTier,cycle:currentCycle})});
            const data=await res.json();
            if(data.payment_session_id){const cf=Cashfree({mode:"sandbox"});cf.checkout({paymentSessionId:data.payment_session_id});}
            else{alert("Error: "+data.error);}
        }catch(e){alert("Server Error");}
        btn.innerText=orig;
    }

    const loginModal=document.getElementById('loginModal');function openLoginModal(){loginModal.classList.remove('hidden');loginModal.classList.add('flex');if(window.google){google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID,callback:handleGoogleRes});google.accounts.id.renderButton(document.getElementById("googleBtnContainer"),{theme:"filled_black",size:"large"});}}function closeLoginModal(){loginModal.classList.add('hidden');loginModal.classList.remove('flex');}
    async function handleGoogleRes(res){const r=await fetch(`${BACKEND_URL}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:res.credential})});const d=await r.json();if(d.success){localStorage.setItem('whisUser',JSON.stringify(d.user));currentUser=d.user;fetchUserStatus();closeLoginModal();}}
    const uStr=localStorage.getItem('whisUser');if(uStr){currentUser=JSON.parse(uStr);fetchUserStatus();}
  </script>
</body>
</html>
